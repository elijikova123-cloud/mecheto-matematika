<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—á–µ—Ç–æ - –ü—ä–ª–Ω–∞ –¢–∞–±–ª–∏—Ü–∞</title>
    <style>
        body { 
            margin: 0; overflow: hidden;
            background: linear-gradient(to bottom, #1e5128, #4e944f);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }
        .leaf {
            position: absolute; width: 20px; height: 20px; background: #81c784;
            border-radius: 50% 0 50% 0; opacity: 0.6; animation: fall 5s linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); left: calc(var(--pos)); }
            100% { transform: translateY(110vh) rotate(360deg); left: calc(var(--pos) + 50px); }
        }
        #game-container { 
            width: 90%; max-width: 850px; background: rgba(255, 255, 255, 0.95); 
            padding: 25px; border-radius: 40px; box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            border: 8px solid #5d4037; text-align: center; position: relative; z-index: 10;
        }
        .bear-area { font-size: 80px; display: inline-block; transition: 0.3s; }
        .jump { animation: jumpAnim 0.5s ease; }
        @keyframes jumpAnim { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px) scale(1.1); } }
        
        #bees-attack {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 60px; display: none; z-index: 100; pointer-events: none;
        }
        .buzz { animation: buzzAnim 0.1s infinite; }
        @keyframes buzzAnim { 0% { transform: translate(-50%, -50%) translate(3px, 3px); } 100% { transform: translate(-50%, -50%) translate(-3px, -3px); } }

        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .menu-btn { 
            background: #ffa000; color: white; border: none; padding: 15px; 
            border-radius: 20px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 5px #e65100;
        }
        .pots-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px; }
        .pot { 
            background: #ffc107; padding: 15px 5px; border-radius: 15px 15px 45% 45%;
            border: 3px solid #8d6e63; font-size: 1.4rem; font-weight: bold; cursor: pointer;
        }
        .stats-bar { display: flex; justify-content: space-around; font-weight: bold; margin-bottom: 15px; background: #f9f9f9; padding: 10px; border-radius: 20px; }
        #question { font-size: 3rem; margin: 10px 0; background: #fffde7; border-radius: 20px; padding: 10px; }
        .screen { display: none; }
        .active { display: block; }
    </style>
</head>
<body>

<script>
    for(let i=0; i<15; i++) {
        document.write(`<div class="leaf" style="--pos:${Math.random()*100}%; animation-delay:${Math.random()*5}s"></div>`);
    }
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, duration) {
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }
</script>

<div id="game-container">
    <div id="bees-attack">üêùüêùüêù<br>üêùüêªüêù<br>üêùüêùüêù</div>

    <div id="screen-menu" class="screen active">
        <h1>üå≤ –ì–æ—Ä—Å–∫–æ —É—á–∏–ª–∏—â–µ üçØ</h1>
        <p>–ù–∞—É—á–∏ —Ü—è–ª–∞—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ (20 –∑–∞–¥–∞—á–∏)!</p>
        <div class="menu-grid" id="menu-btns"></div>
    </div>

    <div id="screen-game" class="screen">
        <div class="stats-bar">
            <div>üå≥ –ß–∏—Å–ª–æ: <span id="level-txt"></span></div>
            <div>‚ù§Ô∏è –ì—Ä–µ—à–∫–∏: <span id="err-txt">0</span>/3</div>
            <div>‚≠ê –ü—Ä–æ–≥—Ä–µ—Å: <span id="prog-txt">0</span>/20</div>
        </div>
        <div class="bear-area" id="main-bear">üêª</div>
        <div id="task-type" style="font-weight: bold; color: #5d4037;">–£–º–Ω–æ–∂–µ–Ω–∏–µ</div>
        <div id="question">?</div>
        <div class="pots-grid" id="pots-area"></div>
    </div>
</div>

<script>
    let tableNum = 2; let errors = 0; let progress = 0; let answer = 0;
    let pendingTasks = [];

    const menuDiv = document.getElementById('menu-btns');
    for(let i=2; i<=10; i++) {
        let b = document.createElement('button');
        b.className = 'menu-btn';
        b.innerText = '–¢–∞–±–ª–∏—Ü–∞ —Å ' + i;
        b.onclick = () => { audioCtx.resume(); start(i); };
        menuDiv.appendChild(b);
    }

    function start(n) {
        tableNum = n; errors = 0; progress = 0;
        // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Å–ø–∏—Å—ä–∫ —Å –≤—Å–∏—á–∫–∏ 20 –∑–∞–¥–∞—á–∏ (10 —É–º–Ω–æ–∂–µ–Ω–∏–µ –∏ 10 –¥–µ–ª–µ–Ω–∏–µ)
        pendingTasks = [];
        for(let i=1; i<=10; i++) pendingTasks.push({type: 'mul', val: i});
        for(let i=1; i<=10; i++) pendingTasks.push({type: 'div', val: i});
        
        // –†–∞–∑–±—ä—Ä–∫–≤–∞–º–µ –∑–∞–¥–∞—á–∏—Ç–µ, –∑–∞ –¥–∞ –Ω–µ —Å–∞ –ø–æ–¥—Ä–µ–¥ (–ø–æ-–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –µ)
        pendingTasks.sort(() => Math.random() - 0.5);

        document.getElementById('screen-menu').classList.remove('active');
        document.getElementById('screen-game').classList.add('active');
        nextTask(); update();
    }

    function nextTask() {
        if(pendingTasks.length === 0) {
            playSound(800, 'sine', 0.8);
            alert("–ù–ï–í–ï–†–û–Ø–¢–ù–û! –¢–∏ —Ä–µ—à–∏ –≤—Å–∏—á–∫–∏ 20 –∑–∞–¥–∞—á–∏ –∑–∞ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ —Å " + tableNum + "! ‚≠êüçØ");
            location.reload();
            return;
        }

        let task = pendingTasks[0];
        let typeText = document.getElementById('task-type');
        
        if(task.type === 'mul') {
            typeText.innerText = "–£–º–Ω–æ–∂–µ–Ω–∏–µ üêù";
            answer = task.val * tableNum;
            document.getElementById('question').innerText = `${task.val} √ó ${tableNum} = ?`;
            drawPots(true);
        } else {
            typeText.innerText = "–î–µ–ª–µ–Ω–∏–µ üçØ";
            answer = task.val;
            document.getElementById('question').innerText = `${task.val * tableNum} : ${tableNum} = ?`;
            drawPots(false);
        }
    }

    function drawPots(isMul) {
        const area = document.getElementById('pots-area');
        area.innerHTML = '';
        // –ü–æ–∫–∞–∑–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –≤—ä–∑–º–æ–∂–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ (–æ—Ç 1 –¥–æ 10 –∑–∞ –¥–µ–ª–µ–Ω–∏–µ –∏–ª–∏ n –¥–æ 10n –∑–∞ —É–º–Ω–æ–∂–µ–Ω–∏–µ)
        for(let i=1; i<=10; i++) {
            let val = isMul ? i * tableNum : i;
            let p = document.createElement('div');
            p.className = 'pot';
            p.innerText = val;
            p.onclick = () => check(val);
            area.appendChild(p);
        }
    }

    function check(v) {
        const bear = document.getElementById('main-bear');
        if(v === answer) {
            progress++;
            pendingTasks.shift(); // –ú–∞—Ö–∞–º–µ —Ä–µ—à–µ–Ω–∞—Ç–∞ –∑–∞–¥–∞—á–∞
            playSound(600, 'sine', 0.2);
            bear.classList.add('jump');
            setTimeout(() => bear.classList.remove('jump'), 500);
            update(); nextTask();
        } else {
            errors++;
            playSound(150, 'sawtooth', 0.3);
            if(errors >= 3) {
                const bees = document.getElementById('bees-attack');
                bees.style.display = 'block'; bees.classList.add('buzz');
                let buzzInterval = setInterval(() => playSound(100, 'square', 0.05), 100);
                setTimeout(() => {
                    clearInterval(buzzInterval);
                    bees.style.display = 'none';
                    alert("–û–ø–∏—Ç–∞–π –ø–∞–∫! –¢—Ä—è–±–≤–∞ –¥–∞ —Å–∏ –ø–æ-–≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω —Å –ø—á–µ–ª–∏—Ç–µ!");
                    location.reload();
                }, 2000);
            }
            update();
        }
    }

    function update() {
        document.getElementById('level-txt').innerText = tableNum;
        document.getElementById('err-txt').innerText = errors;
        document.getElementById('prog-txt').innerText = progress;
    }
</script>
</body>
</html>
